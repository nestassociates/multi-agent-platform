---
/**
 * Homepage
 * T061: Updated to use real agent data from API
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import PropertyCard from '../components/PropertyCard.astro';
import { getSiteData, getProperties, placeholderData, getContentByType } from '../lib/data';

// Load site data
const siteData = await getSiteData() || placeholderData;
const properties = await getProperties(siteData.agent.id);
const blogPosts = getContentByType(siteData, 'blog_post').slice(0, 3);

// Get property counts
const activeProperties = properties.filter(p => p.status === 'available').length;
---

<BaseLayout
  title={`${siteData.agent.name} - Real Estate Agent`}
  description={siteData.agent.bio || 'Professional real estate services'}
  siteData={siteData}
>
  <!-- Hero Section -->
  <Hero
    name={siteData.agent.name}
    tagline={siteData.agent.bio || 'Your trusted local property expert'}
    primaryCta={{ text: 'View Properties', href: '/properties' }}
    secondaryCta={{ text: 'Contact Me', href: '/contact' }}
  />

  <!-- Quick Stats -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-8 text-center">
        <div class="bg-gray-50 p-8 rounded-xl">
          <h3 class="text-5xl font-bold text-blue-600 mb-2">{activeProperties}</h3>
          <p class="text-gray-600 font-medium">Active Properties</p>
        </div>
        <div class="bg-gray-50 p-8 rounded-xl">
          <h3 class="text-5xl font-bold text-blue-600 mb-2">{properties.length}</h3>
          <p class="text-gray-600 font-medium">Total Listings</p>
        </div>
        <div class="bg-gray-50 p-8 rounded-xl">
          <h3 class="text-5xl font-bold text-blue-600 mb-2">{siteData.agent.qualifications?.length || 0}</h3>
          <p class="text-gray-600 font-medium">Qualifications</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Properties -->
  {properties.length > 0 && (
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">Featured Properties</h2>
          <p class="text-gray-600 text-lg max-w-2xl mx-auto">
            Browse my latest property listings
          </p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {properties.slice(0, 6).map((property) => (
            <PropertyCard
              property={{
                slug: property.slug || property.id,
                title: property.title,
                price: property.price,
                bedrooms: property.bedrooms,
                bathrooms: property.bathrooms,
                address: property.address || property.postcode,
                images: property.images,
                listingType: property.transactionType === 'rent' ? 'To Let' : 'For Sale',
              }}
            />
          ))}
        </div>

        {properties.length > 6 && (
          <div class="text-center mt-12">
            <a
              href="/properties"
              class="inline-flex items-center gap-2 bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
            >
              View All Properties
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
          </div>
        )}
      </div>
    </section>
  )}

  <!-- About Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-2 gap-12 items-center">
        <div>
          {siteData.agent.avatarUrl ? (
            <img
              src={siteData.agent.avatarUrl}
              alt={siteData.agent.name}
              class="w-full max-w-md mx-auto rounded-2xl shadow-xl"
            />
          ) : (
            <div class="w-full max-w-md mx-auto aspect-square bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl shadow-xl flex items-center justify-center">
              <span class="text-8xl text-white font-bold">
                {siteData.agent.name.split(' ').map(n => n[0]).join('')}
              </span>
            </div>
          )}
        </div>
        <div>
          <h2 class="text-3xl md:text-4xl font-bold mb-6">About {siteData.agent.name}</h2>
          {siteData.agent.bio ? (
            <p class="text-gray-600 text-lg mb-6 leading-relaxed">{siteData.agent.bio}</p>
          ) : (
            <p class="text-gray-600 text-lg mb-6 leading-relaxed">
              I'm a professional estate agent dedicated to helping you find your perfect property.
              With years of experience in the local market, I provide expert guidance through
              every step of your property journey.
            </p>
          )}

          {siteData.agent.qualifications && siteData.agent.qualifications.length > 0 && (
            <div class="mb-6">
              <h3 class="font-semibold text-gray-900 mb-2">Qualifications</h3>
              <div class="flex flex-wrap gap-2">
                {siteData.agent.qualifications.map((qual: string) => (
                  <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">
                    {qual}
                  </span>
                ))}
              </div>
            </div>
          )}

          <a
            href="/about"
            class="inline-flex items-center gap-2 text-blue-600 font-semibold hover:text-blue-700 transition"
          >
            Learn more about me
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Blog Posts -->
  {blogPosts.length > 0 && (
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">Latest Articles</h2>
          <p class="text-gray-600 text-lg">
            Property tips, market insights, and local area guides
          </p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          {blogPosts.map((post) => (
            <article class="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md transition">
              {post.featuredImageUrl && (
                <img
                  src={post.featuredImageUrl}
                  alt={post.title}
                  class="w-full h-48 object-cover"
                />
              )}
              <div class="p-6">
                <h3 class="text-xl font-semibold mb-2 line-clamp-2">
                  <a href={`/blog/${post.slug}`} class="hover:text-blue-600 transition">
                    {post.title}
                  </a>
                </h3>
                {post.excerpt && (
                  <p class="text-gray-600 mb-4 line-clamp-3">{post.excerpt}</p>
                )}
                <a
                  href={`/blog/${post.slug}`}
                  class="text-blue-600 font-medium hover:text-blue-700"
                >
                  Read more &rarr;
                </a>
              </div>
            </article>
          ))}
        </div>

        <div class="text-center mt-12">
          <a
            href="/blog"
            class="text-blue-600 font-semibold hover:text-blue-700"
          >
            View all articles &rarr;
          </a>
        </div>
      </div>
    </section>
  )}

  <!-- Call to Action -->
  <section class="py-20 bg-blue-600 text-white">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Ready to Find Your Dream Home?</h2>
      <p class="text-xl text-blue-100 mb-8 max-w-2xl mx-auto">
        Let's work together to find the perfect property for you. Get in touch today for a free consultation.
      </p>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a
          href="/contact"
          class="bg-white text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition shadow-lg"
        >
          Get in Touch
        </a>
        {siteData.agent.phone && (
          <a
            href={`tel:${siteData.agent.phone}`}
            class="border-2 border-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-white hover:text-blue-600 transition"
          >
            Call {siteData.agent.phone}
          </a>
        )}
      </div>
    </div>
  </section>
</BaseLayout>
